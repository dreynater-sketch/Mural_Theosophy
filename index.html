<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Artwork Analyzer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }

        .container {
            max-width: 100vw;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .camera-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin: 0 auto 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        #video {
            width: 100%;
            border-radius: 15px;
            background: #333;
            display: none;
        }

        #canvas {
            display: none;
        }

        .camera-placeholder {
            width: 100%;
            height: 300px;
            background: rgba(255,255,255,0.2);
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            border: 2px dashed rgba(255,255,255,0.5);
        }

        .camera-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.7;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            min-width: 140px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #4834d4, #686de0);
            color: white;
        }

        .btn-success {
            background: linear-gradient(45deg, #26de81, #20bf6b);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .analysis-container {
            background: rgba(255,255,255,0.95);
            color: #333;
            border-radius: 20px;
            padding: 25px;
            margin-top: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            max-height: 400px;
            overflow-y: auto;
        }

        .analysis-container h3 {
            color: #4834d4;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .analysis-container p {
            line-height: 1.6;
            font-size: 1.05rem;
        }

        .loading {
            text-align: center;
            padding: 30px;
        }

        .loading-spinner {
            border: 4px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top: 4px solid white;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: linear-gradient(45deg, #ff4757, #ff3742);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
        }

        .captured-image {
            width: 100%;
            border-radius: 15px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .header p {
                font-size: 1rem;
            }
            
            .btn {
                padding: 12px 20px;
                font-size: 1rem;
                min-width: 120px;
            }
            
            .container {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎨 Art Analyzer</h1>
            <p>Point your camera at artwork to get instant AI-powered descriptions</p>
        </div>

        <div class="camera-container">
            <video id="video" autoplay playsinline></video>
            <canvas id="canvas"></canvas>
            
            <div id="camera-placeholder" class="camera-placeholder">
                <div class="camera-icon">📷</div>
                <p>Camera access required</p>
                <small>We'll analyze artwork in real-time</small>
            </div>
        </div>

        <div class="controls">
            <button id="startCamera" class="btn btn-primary">Start Camera</button>
            <button id="captureBtn" class="btn btn-success" disabled>Analyze Artwork</button>
            <button id="stopCamera" class="btn btn-secondary" disabled>Stop Camera</button>
        </div>

        <div id="analysisResult"></div>
    </div>

    <script>
        let stream = null;
        let video = document.getElementById('video');
        let canvas = document.getElementById('canvas');
        let ctx = canvas.getContext('2d');

        // Button elements
        const startCameraBtn = document.getElementById('startCamera');
        const captureBtn = document.getElementById('captureBtn');
        const stopCameraBtn = document.getElementById('stopCamera');
        const placeholder = document.getElementById('camera-placeholder');
        const analysisResult = document.getElementById('analysisResult');

        // Check if device supports camera
        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
            showError('Camera access is not supported on this device or browser.');
        }

        startCameraBtn.addEventListener('click', startCamera);
        captureBtn.addEventListener('click', captureAndAnalyze);
        stopCameraBtn.addEventListener('click', stopCamera);

        async function startCamera() {
            try {
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: 'environment', // Use back camera if available
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    } 
                });
                
                video.srcObject = stream;
                video.style.display = 'block';
                placeholder.style.display = 'none';
                
                startCameraBtn.disabled = true;
                captureBtn.disabled = false;
                stopCameraBtn.disabled = false;
                
                // Clear any previous analysis
                analysisResult.innerHTML = '';
                
            } catch (error) {
                console.error('Error accessing camera:', error);
                let errorMsg = 'Unable to access camera. ';
                
                if (error.name === 'NotAllowedError') {
                    errorMsg += 'Please allow camera permissions and try again.';
                } else if (error.name === 'NotFoundError') {
                    errorMsg += 'No camera found on this device.';
                } else {
                    errorMsg += 'Please check your camera settings.';
                }
                
                showError(errorMsg);
            }
        }

        function stopCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            
            video.style.display = 'none';
            placeholder.style.display = 'flex';
            
            startCameraBtn.disabled = false;
            captureBtn.disabled = true;
            stopCameraBtn.disabled = true;
        }

        async function captureAndAnalyze() {
            if (!stream) return;
            
            // Set canvas size to match video
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            // Draw current frame to canvas
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // Convert to base64
            const imageDataUrl = canvas.toDataURL('image/jpeg', 0.8);
            const base64Data = imageDataUrl.split(',')[1];
            
            // Show loading state
            showLoading();
            
            try {
                // Send to Claude API for analysis
                const analysis = await analyzeArtwork(base64Data, imageDataUrl);
                showAnalysis(analysis, imageDataUrl);
            } catch (error) {
                console.error('Analysis error:', error);
                showError('Failed to analyze the artwork. Please try again.');
            }
        }

        async function analyzeArtwork(base64Data, imageDataUrl) {
            const response = await fetch("https://api.anthropic.com/v1/messages", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    model: "claude-sonnet-4-20250514",
                    max_tokens: 1000,
                    messages: [
                        {
                            role: "user",
                            content: [
                                {
                                    type: "image",
                                    source: {
                                        type: "base64",
                                        media_type: "image/jpeg",
                                        data: base64Data,
                                    }
                                },
                                {
                                    type: "text",
                                    text: "Please analyze this artwork and provide a detailed description. Include information about: the artistic style, medium (if discernible), composition, colors, subject matter, possible time period, and any notable artistic techniques or elements you observe. If you recognize the artwork or artist, please mention that as well. Keep your response engaging and informative for someone viewing the art."
                                }
                            ]
                        }
                    ]
                })
            });

            if (!response.ok) {
                throw new Error(`API request failed: ${response.status}`);
            }

            const data = await response.json();
            return data.content[0].text;
        }

        function showLoading() {
            analysisResult.innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>Analyzing artwork with AI...</p>
                </div>
            `;
        }

        function showAnalysis(analysis, imageUrl) {
            analysisResult.innerHTML = `
                <div class="analysis-container">
                    <img src="${imageUrl}" alt="Captured artwork" class="captured-image">
                    <h3>🎨 Artwork Analysis</h3>
                    <p>${analysis}</p>
                </div>
            `;
        }

        function showError(message) {
            analysisResult.innerHTML = `
                <div class="error">
                    <strong>⚠️ Error:</strong> ${message}
                </div>
            `;
        }

        // Handle page visibility changes (stop camera when page is hidden)
        document.addEventListener('visibilitychange', function() {
            if (document.hidden && stream) {
                stopCamera();
            }
        });

        // Handle orientation changes on mobile
        window.addEventListener('orientationchange', function() {
            setTimeout(() => {
                if (stream && video.style.display !== 'none') {
                    // Refresh camera after orientation change
                    stopCamera();
                    setTimeout(startCamera, 100);
                }
            }, 100);
        });
    </script>
</body>
</html>